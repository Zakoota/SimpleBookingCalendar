"use strict";function _instanceof(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,r=new Array(e);a<e;a++)r[a]=t[a];return r}function _iterableToArrayLimit(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var a=[],r=!0,n=!1,s=void 0;try{for(var c,o=t[Symbol.iterator]();!(r=(c=o.next()).done)&&(a.push(c.value),!e||a.length!==e);r=!0);}catch(t){n=!0,s=t}finally{try{r||null==o.return||o.return()}finally{if(n)throw s}}return a}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!_instanceof(t,e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,a){return e&&_defineProperties(t.prototype,e),a&&_defineProperties(t,a),t}var SimpleBookingCalendar=function(){function t(e,a){_classCallCheck(this,t),this._init_props();var r=document.getElementById(e);if(!r)throw"Element ID is required";this.calendarElement=r,this.ajaxSrc=a,this.init()}return _createClass(t,[{key:"_init_props",value:function(){calendarElement=null,calendarBody=null,ajaxSrc=null,ajaxResponse=null,selectedStart=null,selectedEnd=null,selectedGate=null,currentMonth=(new Date).getMonth(),currentYear=(new Date).getFullYear(),_evts=[],monthText=["January","February","March","April","May","June","July","August","September","October","November","December"]}},{key:"ajaxOpts",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"string"==typeof t?{url:t,type:"GET",data:{date:this.toFullDateString(this.currentYear,this.currentMonth)},success:function(t){this.ajaxResponse=t}.bind(this),complete:e}:"object"==_typeof(t)?t:void 0}},{key:"init",value:function(){var t;this.calendarElement.innerHTML='<table class="calendar"><caption class="calendar__banner--month"><h1 id="period_label"></h1></caption><thead><tr><th class="calendar__day__header">Sun</th><th class="calendar__day__header">Mon</th><th class="calendar__day__header">Tue</th><th class="calendar__day__header">Wed</th><th class="calendar__day__header">Thu</th><th class="calendar__day__header">Fri</th><th class="calendar__day__header">Sat</th></tr></thead><tbody id="calendarBody"></tbody></table>',this.calendarBody=document.getElementById("calendarBody"),this.calendarBody.addEventListener("mouseenter",(t=this,function(e){for(var a=e.target;a&&a!=this;a=a.parentNode)if(a.classList&&a.classList.contains("calendar__day__cell")){t.selectedEnd||function(){a.classList.add("hover_day");var e=t._dateToUTC(a.getAttribute("data-date"));t.selectedStart&&(t.selectedGate=!1,t.calendarBody.querySelectorAll("td").forEach(function(a){if(a.classList.remove("hover_day"),t._dateToUTC(a.getAttribute("data-date"))<=e&&t._dateToUTC(a.getAttribute("data-date"))>t._dateToUTC(t.selectedStart)){if(a.classList.contains("calendar__day__booked")||t.selectedGate)return void(t.selectedGate=a.getAttribute("data-date"));a.classList.add("hover_day")}}))}();break}}),!0),this.calendarBody.addEventListener("mouseout",function(t){return function(e){for(var a=e.target;a&&a!=this;a=a.parentNode)if(a.classList&&a.classList.contains("calendar__day__cell")&&!t.selectedEnd){a.classList.remove("hover_day");break}}}(this),!0),this.calendarBody.addEventListener("click",function(t){return function(e){for(var a=e.target;a&&a!=this;a=a.parentNode)if(a.classList&&a.classList.contains("calendar__day__cell")){t.selectedStart?a.getAttribute("data-date")!=t.selectedStart||t.selectedEnd?t.selectedEnd||t.selectedGate?a.getAttribute("data-date")==t.selectedEnd&&(t._evts.unselect&&t._evts.unselect.forEach(function(e){e("end",t.selectedEnd)}),a.classList.remove("selected_day"),t.selectedEnd=null):(t.selectedEnd=a.getAttribute("data-date"),a.classList.add("selected_day"),t._evts.select&&t._evts.select.forEach(function(e){e("end",t.selectedEnd)}),t._evts.rangeselect&&t._evts.rangeselect.forEach(function(e){e(t.selectedStart,t.selectedEnd,t)})):(t._evts.unselect&&t._evts.unselect.forEach(function(e){e("start",t.selectedStart)}),t.selectedStart=null,a.classList.remove("selected_day")):(t.selectedStart=a.getAttribute("data-date"),a.classList.add("selected_day"),t._evts.select&&t._evts.select.forEach(function(e){e("start",t.selectedStart)}));break}}}(this),!0),this.render()}},{key:"toFullDateString",value:function(t,e,a){return new Date(t||this.currentYear,e||this.currentMonth,a||2).toISOString().substr(0,10)}},{key:"next",value:function(){this.currentYear=11===this.currentMonth?this.currentYear+1:this.currentYear,this.currentMonth=(this.currentMonth+1)%12,this.render()}},{key:"previous",value:function(){this.currentYear=0===this.currentMonth?this.currentYear-1:this.currentYear,this.currentMonth=0===this.currentMonth?11:this.currentMonth-1,this.render()}},{key:"jump",value:function(t,e){this.currentYear=parseInt(e),this.currentMonth=parseInt(t),this.render()}},{key:"select",value:function(t,e){var a=this;this.selectedStart=this.toFullDateString(t.getFullYear(),t.getMonth(),t.getDate()),this.selectedEnd=this.toFullDateString(e.getFullYear(),e.getMonth(),e.getDate()),this.selectedGate=!1;var r=!1;return this.calendarBody.querySelectorAll("td").forEach(function(t){if(t.classList.remove("hover_day"),a._dateToUTC(t.getAttribute("data-date"))<=currDate&&a._dateToUTC(t.getAttribute("data-date"))>a._dateToUTC(a.selectedStart)){if(t.classList.contains("calendar__day__booked")||a.selectedGate)return void(r=!1);t.classList.add("hover_day"),r=!0}}),r}},{key:"unselect",value:function(){this.selectedStart=null,this.selectedEnd=null,this.calendarBody.querySelectorAll("td").forEach(function(t){t.classList.contains("hover_day")&&t.classList.remove("hover_day")})}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentMonth,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.currentYear;if(this.ajaxSrc){this._ajax(this.ajaxOpts(this.ajaxSrc,function(){this._render(t,e)}.bind(this)))}else this._render(t,e)}},{key:"_render",value:function(t,e){document.getElementById("period_label").innerText="".concat(this.monthText[t]," ").concat(e);for(var a=32-new Date(e,t,32).getDate(),r=0,n="<tr>",s=1;s<=a;s++){if(1===s)for(var c=new Date(e,t,s).getDay(),o=0;o<c;o++)r++,n+='<td class="calendar__day__booked"></td>';var l="";if(this._dateToUTC(this.toFullDateString(e,t,s+1))<=(new Date).getTime()-864e5&&(l+='data-bank-holiday=""'),this.ajaxResponse[this.toFullDateString(e,t,s+1)]?n+='<td class="calendar__day__booked" data-moon-phase="Booked" data-date="'.concat(this.toFullDateString(e,t,s+1),'" ').concat(l,">").concat(s,"</td>"):this.selectedStart&&!this.selectedEnd?n+='<td class="calendar__day__cell '.concat(this.toFullDateString(e,t,s+1)==this.selectedStart?"hover_day":null,'"  data-date="').concat(this.toFullDateString(e,t,s+1),'" ').concat(l,">").concat(s,"</td>"):this.selectedStart&&this.selectedEnd?n+='<td class="calendar__day__cell '.concat(this.toFullDateString(e,t,s+1)>=this.selectedStart&&this.toFullDateString(e,t,s+1)<=this.selectedEnd?"hover_day":null,'"  data-date="').concat(this.toFullDateString(e,t,s+1),'" ').concat(l,">").concat(s,"</td>"):n+='<td class="calendar__day__cell"  data-date="'.concat(this.toFullDateString(e,t,s+1),'" ').concat(l,">").concat(s,"</td>"),s===a)for(var i=new Date(e,t,s).getDay()+1;i<7;i++)n+='<td class="calendar__day__booked"></td>';(s+r)%7==0&&(n+="</tr>")}this.calendarBody.innerHTML=n}},{key:"on",value:function(t,e){this._evts[t]||(this._evts[t]=[]),this._evts[t].push(e)}},{key:"_ajax",value:function(t){var e;e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),(e=new XMLHttpRequest).onreadystatechange=function(){if(4==this.readyState){if(200===this.status){var e=this.responseText;if("application/json"==this.getResponseHeader("content-type"))try{e=JSON.parse(e)}catch(t){console.error(t)}t.success&&t.success(e,this.status)}else t.error&&t.error();t.complete&&t.complete()}},"GET"==t.type&&(t.url+="?".concat(this._object2param(t.data)),t.data=null),e.open(t.type,t.url,!0),t.beforeSend&&t.beforeSend(),e.send(t.data&&this._object2param(t.data))}},{key:"_object2param",value:function(t){return Object.entries(t).map(function(t){var e=_slicedToArray(t,2),a=e[0],r=e[1];return"".concat(encodeURIComponent(a),"=").concat(encodeURIComponent(r))}).join("&")}},{key:"_dateToUTC",value:function(t){return new Date(t).getTime()}},{key:"startDate",get:function(){return this.selectedStart}},{key:"endDate",get:function(){return this.selectedEnd}}]),t}();